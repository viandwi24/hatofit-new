import{g as E,J as b,M as g,E as p,I as h,o as _,c as S,s as O,x as $}from"./entry.s6_xT4rN.js";import{u as j}from"./FormGroup.ZBHdrGHE.js";import{a as A}from"./index.EfYUjtb8.js";import{_ as J}from"./_plugin-vue_export-helper.x3n3nnut.js";class m extends Error{constructor(s){super(s),this.message=s,Object.setPrototypeOf(this,m.prototype)}}const Y=E({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:s,emit:r}){const n=j("$Z55GngiEgp"),u=A(`form-${n}`);b(()=>{u.on(async t=>{var i;t.type!=="submit"&&((i=e.validateOn)!=null&&i.includes(t.type))&&await d(t.path,{silent:!0})})}),g(()=>{u.reset()});const a=p([]);h("form-errors",a),h("form-events",u);const f=p({});h("form-inputs",f);async function y(){let t=await e.validate(e.state);if(e.schema)if(F(e.schema))t=t.concat(await I(e.state,e.schema));else if(k(e.schema))t=t.concat(await B(e.state,e.schema));else if(M(e.schema))t=t.concat(await P(e.state,e.schema));else if(U(e.schema))t=t.concat(await V(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function d(t,i={silent:!1}){let o=t;if(t&&!Array.isArray(t)&&(o=[t]),o){const c=a.value.filter(l=>!o.includes(l.path)),v=(await y()).filter(l=>o.includes(l.path));a.value=c.concat(v)}else a.value=await y();if(!i.silent&&a.value.length>0)throw new m(`Form validation failed: ${JSON.stringify(a.value,null,2)}`);return e.state}async function w(t){var o;const i=t;try{(o=e.validateOn)!=null&&o.includes("submit")&&await d();const c={...i,data:e.state};r("submit",c)}catch(c){if(!(c instanceof m))throw c;const v={...i,errors:a.value.map(l=>({...l,id:f.value[l.path]}))};r("error",v)}}return s({validate:d,errors:a,setErrors(t,i){a.value=t,i?a.value=a.value.filter(o=>o.path!==i).concat(t):a.value=t},async submit(){await w(new Event("submit"))},getErrors(t){return t?a.value.filter(i=>i.path===t):a.value},clear(t){t?a.value=a.value.filter(i=>i.path!==t):a.value=[]}}),{onSubmit:w}}});function k(e){return e.validate&&e.__isYupSchema__}function x(e){return e.inner!==void 0}async function B(e,s){try{return await s.validate(e,{abortEarly:!1}),[]}catch(r){if(x(r))return r.inner.map(n=>({path:n.path??"",message:n.message}));throw r}}function F(e){return e.parse!==void 0}async function I(e,s){const r=await s.safeParseAsync(e);return r.success===!1?r.error.issues.map(n=>({path:n.path.join("."),message:n.message})):[]}function M(e){return e.validateAsync!==void 0&&e.id!==void 0}function Z(e){return e.isJoi===!0}async function P(e,s){try{return await s.validateAsync(e,{abortEarly:!1}),[]}catch(r){if(Z(r))return r.details.map(n=>({path:n.path.join("."),message:n.message}));throw r}}function U(e){return e._parse!==void 0}async function V(e,s){const r=await s._parse(e);return r.issues?r.issues.map(n=>{var u;return{path:((u=n.path)==null?void 0:u.map(a=>a.key).join("."))||"",message:n.message}}):[]}function q(e,s,r,n,u,a){return _(),S("form",{onSubmit:s[0]||(s[0]=$((...f)=>e.onSubmit&&e.onSubmit(...f),["prevent"]))},[O(e.$slots,"default")],32)}const D=J(Y,[["render",q]]);export{D as _};
